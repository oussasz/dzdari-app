"use strict";(()=>{var e={};e.id=798,e.ids=[798],e.modules={53524:e=>{e.exports=require("@prisma/client")},67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},9962:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>b,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var i={};r.r(i),r.d(i,{POST:()=>p});var s=r(49303),a=r(88716),n=r(60670),o=r(71615),c=r(87070),l=r(69206),d=r(88658);async function p(e){try{if(!l.A)return c.NextResponse.json({message:"Stripe is not configured",ok:!1},{status:500});let t=await e.text(),r=(0,o.headers)().get("stripe-signature");if(!r)return new Response("Invalid signature",{status:400});let i=l.A.webhooks.constructEvent(t,r,process.env.STRIPE_WEBHOOK_SECRET);if("checkout.session.completed"===i.type){if(!i.data.object.customer_details?.email)throw Error("Missing user email");let{listingId:e,startDate:t,endDate:r,totalPrice:s,userId:a}=i.data.object.metadata||{};if(!e||!t||!r||!s||!a)throw Error("Invalid request metadata");await (0,d.createReservation)({listingId:e,startDate:new Date(t),endDate:new Date(r),totalPrice:Number(s),userId:a})}return c.NextResponse.json({result:i,ok:!0})}catch(e){return console.error(e),c.NextResponse.json({message:"Something went wrong",ok:!1},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/webhooks/stripe/route",pathname:"/api/webhooks/stripe",filename:"route",bundlePath:"app/api/webhooks/stripe/route"},resolvedPagePath:"/home/oussasz/Project/Dz Dari/lugario/app/api/webhooks/stripe/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:b,staticGenerationAsyncStorage:m,serverHooks:h}=u,g="/api/webhooks/stripe/route";function f(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},90455:(e,t,r)=>{r.d(t,{L:()=>d});var i=r(67096),s=r.n(i),a=r(13539),n=r(53797),o=r(77234),c=r(77210),l=r(9487);let d={adapter:(0,a.N)(l.db),providers:[(0,c.Z)({clientId:process.env.GITHUB_CLIENT_ID,clientSecret:process.env.GITHUB_CLIENT_SECRET}),(0,o.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,n.Z)({name:"credentials",credentials:{email:{label:"email",type:"text"},password:{label:"password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Invalid credentials");let t=await l.db.user.findUnique({where:{email:e.email}});if(!t||!t?.password||!await s().compare(e.password,t.password))throw Error("Invalid credentials");return t}})],callbacks:{session:async({token:e,session:t})=>(e&&(t.user.id=e.id,t.user.name=e.name,t.user.email=e.email),t),jwt:async({token:e,user:t})=>t?{...e,...t}:e},pages:{signIn:"/"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET}},9487:(e,t,r)=>{r.d(t,{db:()=>s});var i=r(53524);let s=globalThis.prisma||new i.PrismaClient},69206:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(82604);let s=process.env.STRIPE_API_KEY,a=s?new i.Z(s,{apiVersion:"2024-09-30.acacia",typescript:!0}):null},97049:(e,t,r)=>{e.exports=r(23191).vendored["react-rsc"].ReactDOM},51749:(e,t,r)=>{e.exports=r(23191).vendored["react-rsc"].ReactServerDOMWebpackServerEdge},88658:(e,t,r)=>{r.r(t),r.d(t,{$$ACTION_0:()=>p,$$ACTION_1:()=>b,$$ACTION_2:()=>h,$$ACTION_3:()=>f,createPaymentSession:()=>g,createReservation:()=>u,deleteReservation:()=>m,getReservations:()=>d});var i=r(24330);r(60166);var s=r(57708),a=r(9487),n=r(67738),o=r(84848),c=r(69206),l=r(40618);let d=(0,i.j)("31b04723e7c53cd1acbec67b730e7d0abc16a5f7",p);async function p(e){try{let{listingId:t,userId:r,authorId:i,cursor:s}=e,o={};r&&(o.userId=r),t&&(o.listingId=t),i&&(o.listing={userId:i});let c={where:o,take:n.UM,include:{listing:!0},orderBy:{createdAt:"desc"}};s&&(c.cursor={id:s},c.skip=1);let l=await a.db.reservation.findMany({...c}),d=l.length===n.UM?l[n.UM-1].id:null;return{listings:l.map(e=>{let{id:t,startDate:r,endDate:i,totalPrice:s,listing:a}=e;return{...a,reservation:{id:t,startDate:r,endDate:i,totalPrice:s}}}),nextCursor:d}}catch(e){return console.log(e?.message),{listings:[],nextCursor:null}}}let u=(0,i.j)("33f115557067f48ceee4a50b443aa423758b731d",b);async function b({listingId:e,startDate:t,endDate:r,totalPrice:i,userId:n}){try{if(!e||!t||!r||!i)throw Error("Invalid data");await a.db.listing.update({where:{id:e},data:{reservations:{create:{userId:n,startDate:t,endDate:r,totalPrice:i}}}}),(0,s.revalidatePath)(`/listings/${e}`)}catch(e){throw Error(e?.message)}}let m=(0,i.j)("3e9103be237aebf085f90f3c7858dad7d4c215ad",h);async function h(e){try{let t=await (0,o.t)();if(!t)throw Error("Unauthorized");if(!e||"string"!=typeof e)throw Error("Invalid ID");let r=await a.db.reservation.findUnique({where:{id:e}});if(!r)throw Error("Reservation not found!");return await a.db.reservation.deleteMany({where:{id:e,OR:[{userId:t.id},{listing:{userId:t.id}}]}}),(0,s.revalidatePath)("/reservations"),(0,s.revalidatePath)(`/listings/${r.listingId}`),(0,s.revalidatePath)("/trips"),r}catch(e){throw Error(e.message)}}let g=(0,i.j)("0ad09d62211ecf130a12e0b1fb6dd072ad373b1e",f);async function f({listingId:e,startDate:t,endDate:r,totalPrice:i}){if(!e||!t||!r||!i)throw Error("Invalid data");let s=await a.db.listing.findUnique({where:{id:e}});if(!s)throw Error("Listing not found!");let n=await (0,o.t)();if(!n)throw Error("Please log in to reserve!");let l=await c.A.products.create({name:"Listing",images:[s.imageSrc],default_price_data:{currency:"USD",unit_amount:100*i}});return{url:(await c.A.checkout.sessions.create({success_url:`${process.env.NEXT_PUBLIC_SERVER_URL}/trips`,cancel_url:`${process.env.NEXT_PUBLIC_SERVER_URL}/listings/${s.id}`,payment_method_types:["card"],mode:"payment",shipping_address_collection:{allowed_countries:["DE","US","NP","CH","BH","AU"]},metadata:{listingId:e,startDate:String(t),endDate:String(r),totalPrice:i,userId:n.id},line_items:[{price:l.default_price,quantity:1}]})).url}}(0,l.h)([d,u,m,g]),(0,i.j)("1106a624fc89780734d43596a1878891b0872f57",d),(0,i.j)("84b639be183e082fba4d06c9dff2f39883927b92",u),(0,i.j)("2ad9c02f7138be20aaff203fa989dbdd2c65d88f",m),(0,i.j)("578785c17f7947cb2d65472cb4242c57c8621203",g)},84848:(e,t,r)=>{r.d(t,{t:()=>a});var i=r(75571),s=r(90455);let a=async()=>{let e=await (0,i.getServerSession)(s.L);return e?.user}},67738:(e,t,r)=>{r.d(t,{KP:()=>n,UM:()=>c,W$:()=>o,z3:()=>a});var i=r(63759),s=r(43758);let a=[{label:"By Night",icon:i.Paj,description:"Short stay - rent by the night"},{label:"Per Week",icon:i.f$3,description:"Weekly rental - 7 days minimum"},{label:"Per Month",icon:i.sHf,description:"Monthly rental - medium term stay"},{label:"Long Term",icon:i.dKE,description:"Long duration rental (+3 months)"}],n=[{label:"Tourism",icon:i.Yfi,description:"Perfect for tourists and travelers"},{label:"Business",icon:i.KfF,description:"Ideal for business travelers"},{label:"Families",icon:i.Nzl,description:"Family-friendly accommodation"},{label:"Students",icon:i.eAf,description:"Suitable for students"},{label:"Couples",icon:i.Yqy,description:"Romantic getaway for couples"},{label:"Events",icon:i.jsv,description:"For occasions: photo shoots, engagements, birthdays..."}],o=[{label:"Near Beach",icon:i.I4E,description:"Close to the sea"},{label:"Countryside",icon:i.rhR,description:"Rural country house"},{label:"Near Airport",icon:i.vc9,description:"Close to the airport"},{label:"Near University",icon:s.Q7H,description:"Close to university"},{label:"Downtown",icon:i.Ys1,description:"City center location"},{label:"Parking",icon:i.IB_,description:"Parking available"},{label:"Fast WiFi",icon:i.bVG,description:"Strong WiFi connection"},{label:"Air Conditioning",icon:i.yEz,description:"Air conditioning available"},{label:"Smoking Allowed",icon:i.XG1,description:"Smoking is permitted"},{label:"No Smoking",icon:i.eVG,description:"Smoke-free property"},{label:"Pets Allowed",icon:i.WKE,description:"Pet-friendly property"},{label:"Security",icon:i.h9I,description:"Security cameras / guarded"},{label:"Accessible",icon:i.fC4,description:"Suitable for people with disabilities"}],c=16}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,386,76,879,604,972],()=>r(9962));module.exports=i})();